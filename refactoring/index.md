---
description: '- Javascript의 코드 개선'
---

# Index

* 설계가 나쁜 시스템은 수정하기 어렵다&#x20;
* 원하는 동작을 수행하도록 하기 위해 수정해야 할 부분을 찾고, 기존 코드와 잘 맞물려 작동하게 할 방법을 강구하기가 어렵기 때문&#x20;
* 무엇을 수정할지 찾기 어렵다면 실수를 저질러서 버그가 생길 가능성도 높아짐&#x20;



*   글쓴이

    * 수백 줄짜리 코드를 수정할 때면 먼저 프로그램의 작동 방식을 더 쉽게 파악할 수 있도록 코드를 여러 함수와 프로그램 요소로 재구성


* 프로그램의 구조가 빈약하다면 대체로 구조부터 바로잡은 뒤에 기능을 수정하는 편이 작업하기가 훨씬 수월

> 프로그램이 새로운 기능을 추가하기에 편한 구조가 아니라면, 먼저 기능을 추가하기 쉬운 형태로 리팩터링하고 나서 원하는 기능을 추가한다.&#x20;



ex) 사용자의 입맛에 맞게 수정?

1. 청구  내역을  HTML로 출력하는 기능?

* 이러한 변경이 어느 부분에 영향을 주는가?
* 청구 결과에 문자열을 추가하는 문장 각각을 조건문으로 감싸야 함&#x20;
* statement() 함수의 복잡도가 크게 증가한다&#x20;
* 해결책 1 : 이 함수의 복사본을 만들고 복사본에서 HTML을 출력하는 식&#x20;
  * 복사하는 일 자체는 부담 X, 나중에 수많은 문제를 일으킬 여지가 존재&#x20;
  * 청구서 작성 로직 변경 시마다, 기존 함수와 HTML 버전 함수 모두를 수정, 항시 일관되게 수정했는지 확인해야 함&#x20;
* 로직을 변경할 일이 절대 없다면 이렇게 복사해서 붙이는 방식도 ㄱㅊ
  * 내 생각! => 과연????
* 오래 사용할 프로그램이라면 중복 코드는 골칫거리가 됨&#x20;



* 만약 변경이 공연료, 계산법에 영향을 준다면?
  * 새로운 요구사항은 한 부대씩 몰려오기 마련&#x20;



* 연극 장르, 공연료 정책이 달라질 때마다 statement 함수를 수정해야 한다?
  * statement를 복사해서 별도의 htmlStatement()를 만든다면
  * 모든 수정이 두 함수에 일관되게 반영되도록 보장해야함
  * 게다가 정책이 복잡해질수록 수정할 부분을 찾기 어려워지고 수정과정에서 실수할 가능성도 커진다



* 리팩토링이 필요한 이유!
  * 잘 작동하고 나중에 변경할 일이 절대 없다면 코드를 현재 상태로 놔둬도 아무런 문제가 없다&#x20;
  * 더 다듬어두면 물론 좋겠지만, 누군가 코드를 읽지 않는 한 아무런 피해가 없음&#x20;
  * 하지만, 그러다 다른 사람이 읽고 이해해야 할 일이 생겼는데 로직을 파악하기 어렵다면?????

#### 리팩토링의 첫 단계

* 항상 같음, 리팩터링할 코드 영역을 꼼꼼하게 검사해줄 테스트 코드를 만들어야 함&#x20;
* 테스트의 역할은 굉장히 중요&#x20;
* statement 함수의 테스트는?
  * 문자열을 반환, 다양한 장르의 공연들로 구성된 공연료 청구서 몇 개를 미리 작성해 문자열 형태로 준비해둔다면?

> 리팩터링하기 전에 제대로 된 테스트부터 마련한다. 테스트는 반드시 자가진단하도록 만든다.



* 리팩터링 시 테스트에 상당히 의지한다.
  * 내가 저지른 실수로부터 보호해주는 버그 검출기 역할을 해주기 때문&#x20;
  * 원하는 내용을 소스 코드와 테스트 코드 양쪽에 적어두면?
    * 두 번 다 똑같이 실수하지 않는 한 버그 검출기에 반드시 걸림
    * 이와 같은 중복 검사로 실수 가능성을 크게 줄일 수 있음&#x20;
* 테스트를 작성하는 데 시간이 좀 걸리지만, 신경 써서 만들어두면 디버깅 시간이 줄어서 전체 작업 시간은 오히려 단축됨&#x20;

#### statement() 함수 쪼개기&#x20;

* 긴 함수 리팩토링 => 전체 동작을 각각의 부분으로 나눌 수 있는 지점을 찾자&#x20;
*   코드를 분석해서 얻은 정보는 재빨리 코드에 반영해야 함&#x20;

    * 다시 분석하지 않아도, 코드 스스로가 자신이 하는 일이 무엇인지 얘기해줄 것&#x20;


* 코드 조각을 별도 함수로 추출하는 방식으로?
  * 추출한 함수에는 그 코드가 하는 일을 설명하는 이름을 지어준다
  * 나라면? calculateForOnePlay가 낫지 않을까 생각이 들지만?
* **함수 추출하기**
  * 별도 함수로 빼냈을 때 유효범위를 벗어나는 변수, 즉 새 함수에서는 곧바로 사용할 수 없는 변수가 있는지 확인한다.&#x20;
  * 함수 안에서 값이 바뀌는 변수는 조심해서 다루어야 함&#x20;



* 수정하고 나면 곧바로 컴파일하고 테스트해서 실수한 게 없는지 확인한다.
* 아무리 간단한 수정이라도 리팩터링 후에는 항상 테스트하는 습관을 들이는 것이 바람직하다&#x20;
* 사람은 실수하기 마련
  * 한 가지를 수정할 때마다 테스트하면, 오류가 생기더라도 변경 폭이 작기 때문에, 살펴볼 범위도 좁아서 문제를 찾고 해결하기가 훨씬 쉽다&#x20;



* 조금씩 변경하고 매번 테스트하는 것은 리팩터링 절차의 핵심&#x20;
  * 한 번에 너무 많이 수정하려다 실수를 저지르면 디버깅하기 어려워서 결과적으로 작업 시간이 늘어남&#x20;
* 조금씩 수정하여 피드백 주기를 짧게 가져가는 습관이 이러한 재앙을 피하는 길&#x20;



> 리팩터링은 프로그램 수정을 작은 단계로 나눠 진행한다. 그래서 중간에 실수하더라도 버그를 쉽게 찾을 수 있다.&#x20;

* 중첩함수로 만들면 바깥 함수에서 쓰던 변수를 새로 추출한 함수에 매개변수로 전달할 필요가 없어서 편함&#x20;
  * 지금 경우에는 달라질 게 없지만, 일반적으로 중첩 함수로 만들면 할 일 하나가 줄어드는 셈&#x20;
* 방금 수정한 사항을 테스트해보니 문제가 없음&#x20;
  * 하나의 리팩터링을 문제없이 끝낼 때마다 커밋함&#x20;
  * 그래야 중간에 문제가 생기더라도 이전의 정상 상태로 쉽게 돌아갈 수 있음&#x20;
  * 자잘한 변경들이 어느 정도 의미 있는 단위로 뭉쳐지면 공유 저장소로 Push 함



* 함수를 추출하고 나면 추출된 함수 코드를 자세히 들여다보면서 지금보다 명확하게 표현할 수 있는 간단한 방법은 없는지 검토
  * 변수의 이름을 더 명확하게 바꾸어보자&#x20;



* 자바스크립트와 같은 동적 타입 언어를 사용할 때는 타입이 드러나게 작성하면 도움됨&#x20;
  * 매개변수의 역할이 뚜렷하지 않을 때 부정관사를 붙이는 습관이 있으시대

> 컴퓨터가 이해하는 코드는 바보도 작성할 수 있다. 사람이 이해하도록 작성하는 프로그래머가 진정한 실력자다&#x20;

* 좋은 코드라면 하는 일이 명확히 드러나야 하며, 이 때 변수 이름은 커다란 역할을 한다.&#x20;
* 명확성을 높이기 위한 이름 바꾸기에는 조금도 망설이지 말기 바란다.&#x20;



#### play 변수 제거하기&#x20;

*



