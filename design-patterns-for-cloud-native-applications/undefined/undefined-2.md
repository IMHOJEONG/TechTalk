# 서비스 정의 패턴



* 서비스 정의
  * 사용자에게 마이크로서비스 인터페이스를 어떻게 사용할 것인지 정의하는 부분&#x20;
  * 서비스를 정의하는 것과 사용하는 방법은 서로 다름&#x20;

#### 동기 통신에서의 서비스 정의&#x20;

* 서비스 정의는 서비스 레지스트리(service registry)라고 부르는 중앙화된 곳에서 이루어짐&#x20;
* 다른 마이크로서비스 및 개발자들과 상호작용할 수 있는 일종의 메타데이터 스토어라고 볼 수 있음&#x20;
* 서비스 인터페이스 : HTTP 프로토콜을 이용한 RESTful 또는 gRPC와 같이 비동기 통신에 사용하는 프로토콜에 따라서 다양한 기술을 골라서 정의할 수 있음&#x20;

#### 어떻게 동작할까요&#x20;

* 서비스 정의 : 소비자 또는 클라이언트가 원하는 서비스를 어떻게 사용할 것인지를 정의&#x20;
* 사용자는 동기 통신이 이루어지는 서비스 간 통신 채널을 만들기 전 서비스 정의를 참조할 것
* 마이크로서비스는 자신의 서비스에 대한 정의를 서비스 레지스트리에 자동으로 발행하거나, 서비스 소유자 또는 개발자가 수동으로 서비스 정의를 작성해서 발행할 수 있음&#x20;
* 사용자는 서비스 레지스트리에 접근해서 서비스 정의를 찾음 => 서비스 검색&#x20;



* 사용자가 찾아낸 서비스 정의는 클라이언트 애플리케이션을 만들거나 서비스와 통신할 수 있는 적절한 클라이언트 라이브러리를 생성할 때 사용함&#x20;
* 서비스 정의에는 서비스가 제공하는 인터페이스와 더불어 마이크로서비스와 클라이언트 사이에 주고받는 메시지 형식, 데이터 타입 스키마 정보가 포함되어 있음&#x20;



* 서비스 레지스트리 : 서비스 정의를 저장하는 것 외에도 사용자 평점, 리뷰, 다양한 API 관련 요구사항을 만족하기 위한 부수적인 기능을 제공함&#x20;



#### 어떻게 사용할 수 있나요&#x20;

* 서비스 레지스트리 : 서비스 정의와 기타 메타데이터를 관리할 수 있는 API를 제공하는 메타데이터 스토어 형태로 구현하는 경우가 많음&#x20;
* 서비스 레지스트리로는 Consul, etcd, Apache Zookeeper를 들 수 있음&#x20;
* 서비스 레지스트리 : 중앙화된 컴포넌트로 배포해서 사용함&#x20;
  * 서비스 정의 패턴이라는 맥락에서 서비스 레지스트리는 간단히 서비스 메타데이터를 읽고 쓸 수 있는 메타데이터 스토어라고 정의할 수 있음&#x20;
* 서비스 정의 기술은 프로토콜별로 다양&#x20;
  * RESTful 서비스 = 오픈API를, gRPC = 프로토콜 버퍼, GraphQL = GraphQL 스키마를 사용해서 서비스 인터페이스를 정의
  * gRPC와 같은 프로토콜 = 서비스 정의가 반드시 있어야 하는 반면, REST와 같은 방식은 서비스 정의가 필수가 아니기도 함&#x20;
* 클라우드 네이티브 애플리케이션
  * 수많은 마이크로서비스가 상호작용을 해야 하는 만큼 검색하고 사용해야 하는 서비스 각각을 전부 서비스 정의로 만들고 서비스 레지스트리를 통해 원하는 서비스를 검색할 수 있도록 만드는 것이 좋음&#x20;

#### 오픈API와 Consul을 사용해서 RESTful 서비스에 대한 서비스 정의 만들기&#x20;

* 클라우드 네이티브 애플리케이션의 마이크로서비스가 제공하는 비즈니스 인터페이스는 오픈API와 같은 서비스 정의 명세 기술을 사용해서 정의할 수 있음&#x20;
* 만들어진 서비스 정의는 Consul와 같은 서비스 레지스트리에 저장하여 서비스 사용자가 서비스에 대한 메타데이터를 검색하고 사용할 수 있도록 함&#x20;
* 오픈API 정의를 사용하면 사용자는 코드를 생성하고 문서를 참조할 수 있으며 서비스 수준 협약이나 보안 스키마와 같은 정보를 얻을 수 있음&#x20;
* Consul과 같은 서비스 레지스트리는 서비스 카탈로그처럼 서비스 메타데이터에 접근할 수 있는 일원화된 방법을 제공하고 서비스에 대한 정보를 검색하고 얻을 수 있도록 해줌&#x20;

#### 고려해야 할 사항들&#x20;

* 서비스 정의를 만들고 공유하는 방법은 클라우드 네이티브 애플리케이션을 만드는 전반에 걸친 거버넌스와 아주 밀접한 연관을 가짐&#x20;
* 대개 서비스 정의는 중앙화된 서비스 레지스트리에 저장해서 마이크로서비스를 사용하고자 하는 모든 사용자가 서비스를 검색하고 사용할 수 있도록 함&#x20;
* 서비스 레지스트리 => 오픈API 명세나 gRPC 서비스 정의, GraphQL 스키마 등 다양한 종류의 서비스 정의를 모두 다룰 수 있어야 함&#x20;



* 서비스 정의를 도입하면 마이크로서비스의 개발 라이프사이클이 변할 수도 있음&#x20;
  * 서비스 정의를 사용한다면 마이크로서비스 구현에 필요한 코드를 서비스 정의를 통해 생성하거나 혹은 코드 검증을 서비스 정의에 기반해서 할 수도 있음&#x20;
* 서비스를 구현하면 외부에 알려진 서비스 정의와 릴리스하는 마이크로서비스의 구현이 일치하는지 확인할 수 있음&#x20;

#### 관련 패턴들&#x20;

* 서비스 레지스트리 및 검색 패턴과 밀접한 연관을 가짐&#x20;
*





